@page "/room202"

@inject HttpClient httpClient

<h3>Room202</h3>

@if (listOfBeacons is not null)
{
     <MudTable Items="@listOfBeacons" Hover="true" Class="my-5">
        <ToolBarContent>
            <MudText Typo="Typo.h6">Коренные малочисленые народы</MudText>
        </ToolBarContent>
        <HeaderContent>
            <MudTh>Мак</MudTh>
            <MudTh>Дистанция</MudTh>
            <MudTh>Время</MudTh>
            <MudTh></MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Мак">@context.Mac</MudTd>
            <MudTd DataLabel="Дистанция">@context.Distance</MudTd>
            <MudTd DataLabel="Время">@context.TimeStamp.ToString("dd-MM-yyyy HH:mm:ss")</MudTd>
            <MudTd><MudButton Color="Color.Info" @onclick="@((e) => AddToClass(context))">Изменить</MudButton></MudTd>
        </RowTemplate>
    </MudTable>
}
else
{
    <MudProgressCircular Indeterminate="true"></MudProgressCircular>
}



@code {
    BeaconResponse[] beaconResponses;
    List<BeaconResponse> listOfBeacons;

    protected override async Task OnInitializedAsync()
    {
        beaconResponses = await httpClient.GetFromJsonAsync<BeaconResponse[]>("api/gateways/gw/77-88-99-00-11-22");
        listOfBeacons = beaconResponses.ToList();
    }

    private void AddToClass(BeaconResponse context)
    {
        listOfBeacons.RemoveAll(x => x.Mac.Equals(context.Mac, StringComparison.InvariantCultureIgnoreCase));
    }

}
